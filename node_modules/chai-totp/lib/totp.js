/**
 * @Description:
 * @author Lavi Chai
 * @date 2020/2/19 13:01
 */
const HOTP = require('./hotp')
class TOTP extends HOTP {

  genOTP(timeStep = 30, t0 = 0) {
    const T = Math.floor((Date.now() / 1000 - t0) / timeStep)
    return super.genOTP(T)
  }

  verify(otp, timeStep = 30, t0 = 0) {
    return otp === this.genOTP(timeStep, t0)
  }

  /**
   * generate Google Authenticator URL
   * @param {string} username eg. xxx@gmail.com
   * @param {string} org eg. Google
   */
  gaURL(username = '', org = '') {
    return `otpauth://totp/${username}?issuer=${org}&secret=${this.key}`
  }

}

module.exports = TOTP
